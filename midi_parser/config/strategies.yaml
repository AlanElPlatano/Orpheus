# MIDI Parser Tokenization Strategies Configuration
# This file defines presets for different tokenization strategies and use cases

# ============================================================================
# Tokenization Strategy (REMI only)
# ============================================================================

tokenization_strategies:
  REMI:
    name: "REMI (REpresentation of MIdi)"
    description: "Time-based representation optimized for transformer training with bar tokens"
    characteristics:
      vocab_size: medium
      sequence_length: medium
      transformer_suitability: 5
      musical_expressiveness: 4
    recommended_for:
      - transformer_training
      - general_purpose
      - neural_music_generation
      - demo_generation
    config_overrides:
      tokenizer:
        beat_resolution: 8
        num_velocities: 16
        additional_tokens:
          Bar: true                # Critical for REMI, don't modify or shit will fall down
          Chord: true
          Rest: true
          Tempo: true
          TimeSignature: true
          Program: true
          Pedal: false
          PitchBend: false

# ============================================================================
# Use Case Presets
# ============================================================================

use_case_presets:
  # primary use case: 2-track demos
  corrido_demo:
    name: "Corrido Demo Structure"
    description: "2-track demos: strict monophonic melody + sustained chords (no rhythm variation)"
    config_overrides:
      tokenization: "REMI"
      tokenizer:
        pitch_range: [36, 84]       # Typical vocal/guitar range
        beat_resolution: 4          # Standard resolution
        num_velocities: 8           # Reduced (dynamics less critical)
        max_seq_length: 1024        # Shorter for simpler structure
        additional_tokens:
          Bar: true
          Chord: true               # Essential for chord tracking
          Rest: true                # Important for melody phrasing
          Tempo: true
          TimeSignature: true
          Program: true
          Pedal: false
          PitchBend: false
      track_classification:
        chord_threshold: 2          # Easy chord identification
        melody_max_polyphony: 1     # STRICT monophony
        min_notes_per_track: 5
        max_empty_ratio: 0.7
      processing:
        max_duration_seconds: 300.0  # ~5 minute max song length
        chunk_size_seconds: 30.0
      validation:
        enable_round_trip_test: true
        quality_threshold: 0.97
        tolerances:
          note_start_tick: 0        # STRICT timing for chords
          note_duration: 1
          velocity_bin: 1
          missing_notes_ratio: 0.02
          extra_notes_ratio: 0.01
          tempo_bpm_diff: 0.5

  # General-purpose mode (future)
  general_purpose:
    name: "General Purpose"
    description: "Balanced settings for any MIDI file type (future expansion)"
    config_overrides:
      tokenization: "REMI"
      tokenizer:
        pitch_range: [21, 109]      # Full piano range
        beat_resolution: 4
        num_velocities: 16
        max_seq_length: 2048
        additional_tokens:
          Bar: true
          Chord: true
          Rest: true
          Tempo: true
          TimeSignature: true
          Program: true
          Pedal: false
          PitchBend: false
      track_classification:
        chord_threshold: 3
        melody_max_polyphony: 2
        min_notes_per_track: 10
        max_empty_ratio: 0.8
      processing:
        max_duration_seconds: 600.0
      validation:
        enable_round_trip_test: true
        quality_threshold: 0.95

  # Useful for ML training
  transformer_training:
    name: "Transformer Model Training"
    description: "Optimized for training transformer-based music models"
    config_overrides:
      tokenization: "REMI"
      tokenizer:
        beat_resolution: 4
        num_velocities: 16
        max_seq_length: 2048
        additional_tokens:
          Bar: true
          Chord: true
          Rest: true
          Tempo: true
          TimeSignature: true
          Program: true
          Pedal: false
          PitchBend: false
      processing:
        parallel_processing: true
        max_workers: null
      output:
        compress_json: true
        include_vocabulary: true
        pretty_print: false

  # Useful for testing/validation
  high_fidelity:
    name: "High Fidelity Preservation"
    description: "Maximum preservation of original MIDI data for validation"
    config_overrides:
      tokenization: "REMI"
      tokenizer:
        pitch_range: [21, 109]
        beat_resolution: 8
        num_velocities: 64
        max_seq_length: 4096
        additional_tokens:
          Bar: true
          Chord: true
          Rest: true
          Tempo: true
          TimeSignature: true
          Program: true
          Pedal: true
          PitchBend: true
      validation:
        enable_round_trip_test: true
        quality_threshold: 0.99
        tolerances:
          note_start_tick: 0
          note_duration: 0
          velocity_bin: 0
          missing_notes_ratio: 0.001
          extra_notes_ratio: 0.001

# ============================================================================
# Validation Rules
# ============================================================================

validation_rules:
  pitch_range:
    min_value: 0
    max_value: 127
    description: "MIDI note numbers must be 0-127"
  
  beat_resolution:
    min_value: 1
    max_value: 32
    description: "Beat resolution must be reasonable for timing"
  
  num_velocities:
    min_value: 1
    max_value: 128
    description: "Velocity quantization levels"
  
  max_seq_length:
    min_value: 64
    max_value: 16384
    description: "Token sequence length limits"
  
  max_duration_seconds:
    min_value: 1.0
    max_value: 7200.0
    description: "Maximum file duration in seconds"